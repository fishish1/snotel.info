<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-152809378-3"></script>
    <script async src="https://www.google-analytics.com/analytics.js"></script>

    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() {
            dataLayer.push(arguments);
        }
        gtag("js", new Date());

        gtag("config", "UA-152809378-3");

        window.ga =
            window.ga ||
            function () {
                (ga.q = ga.q || []).push(arguments);
            };
        ga.l = +new Date();
        ga("create", "UA-152809378-3", "auto");
        ga("send", "pageview");

        var captureOutboundLink = function (url) {
            ga("send", "event", "outbound", "click", url, {
                transport: "beacon",
                hitCallback: function () {
                    document.location = url;
                }
            });
        };

        var loc = window.location.href + "";
        if (loc.indexOf("http://") == 0 &&
            loc.indexOf("localhost") == -1 &&
            loc.indexOf("127.0.0.1") == -1) {
            window.location.href = loc.replace("http://", "https://");
        }
    </script>

    <link rel="manifest" href="/manifest.json" />
    <link rel="canonical" href="https://snotel.info" />
    <meta name="google-site-verification" content="2kGJFI1-GkmO1_Nzk1Wghiz3Eb2gLwlUQtxQl99VQbA" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="apple-mobile-web-app-title" content="Snow Quickie PWA" />
    <meta property="og:url" content="https://snotel.info" />
    <meta property="og:title" content="SnoTel Dashboard By Snow Intel" />
    <meta property="og:description" content="An app to see SnoTel data, featuring Colorado." />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="/SnotelIcon512.png" />
    <link rel="icon" type="image/png" href="/SnotelIcon512.png" />
    <link rel="apple-touch-icon" href="/SnotelIcon512.png" />

    <title>SnoTel Dashboard</title>
    <meta name="description"
        content="Easily view SnoTel data, including snow depth, snowfall, and more. This app is designed for backcountry enthusiasts in Colorado and beyond." />
    <meta name="keywords" content="NRCS, Snotel, SnoTel, backcountry, snow, snowfall, snow depth, CO, Colorado" />
    <meta name="theme-color" content="#cccccc" />

    <link id="favicon" rel="icon" href="/SnotelIcon512.png" type="image/png" />
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="Brian Fishman" />

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;800&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="/style.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
    <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css" />

    <!-- Add Chart.js annotation plugin for wind direction arrows -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.2.1/moment.min.js"></script>

</head>

<body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.bundle.min.js"></script>
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/iframe-resizer/4.2.1/iframeResizer.contentWindow.min.js"></script>
    <script type="text/javascript" src="//code.jquery.com/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
    <script type="text/javascript" src="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>

    <!-- Map Container -->
    <div id="map"></div>

    <!-- UI Layer -->
    <div id="ui-layer">
        <!-- Top Bar -->
        <div class="top-bar glass-panel">
            <button class="info-btn" onclick="toggleInfoModal()">
                <i class="fa fa-info-circle"></i>
            </button>
            <button class="theme-toggle" onclick="toggleTheme()">
                <i class="fa fa-moon-o" id="theme-icon"></i>
            </button>
            <div id="install_button" style="display: none;">
                <button id="butInstall" class="install-btn" type="button" aria-label="Install App">
                    <i class="fa fa-download"></i>
                </button>
            </div>
            <div class="app-branding">
                <h1>Snotel.Info</h1>
                <h2>NRCS SnoTel Data</h2>
            </div>

            <div class="state-selector-container">
                <select onchange="changeState()" id="State_Selecter">
                    <option value="AK">AK</option>
                    <option value="AZ">AZ</option>
                    <option value="CA">CA</option>
                    <option value="CO">CO</option>
                    <option value="ID">ID</option>
                    <option value="MT">MT</option>
                    <option value="NM">NM</option>
                    <option value="NV">NV</option>
                    <option value="OR">OR</option>
                    <option value="UT">UT</option>
                    <option value="WA">WA</option>
                    <option value="WY">WY</option>
                </select>
            </div>
        </div>

        <!-- Legend (Floating) -->
        <div id="legenddiv" class="legend glass-panel">
            <div class="legend_title" id="legend_title">Current Depth</div>
            <div class="grow">
                <div class="trow" id="L5"> </div>
                <div class="trow" id="T5"> 100" </div>
            </div>
            <div class="grow">
                <div class="trow" id="L4"> </div>
                <div class="trow" id="T4"> 80" </div>
            </div>
            <div class="grow">
                <div class="trow" id="L3"> </div>
                <div class="trow" id="T3"> 60" </div>
            </div>
            <div class="grow">
                <div class="trow" id="L2"> </div>
                <div class="trow" id="T2"> 40" </div>
            </div>


            <div class="grow">
                <div class="trow" id="L1"> </div>
                <div class="trow" id="T1"> 20" </div>
            </div>
            <div class="grow">
                <div class="trow" id="L0"> </div>
                <div class="trow" id="T0"> 0" </div>
            </div>
        </div>

        <!-- Bottom Controls -->
        <div class="bottom-controls glass-panel">
            <div class="slider-class" id="car">
                <div id="Today">Current Depth</div>
                <div id="OneDay">One Day Change</div>
                <div id="FiveDay">Five Day Change</div>
                <div id="Elevation">Elevation (1k ft)</div>
                <div id="Avg">% Avg SWE</div>
            </div>
        </div>
    </div>

    <!-- Chart View -->
    <div id="snowchart">
        <button id="back_to_map" onclick="returnToMap()">
            <i class="fa fa-arrow-left"></i> Back to Map
        </button>

        <div id="loading-indicator"
            style="display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: var(--text-dark); font-size: 24px; z-index: 2;">
            Loading Site Data...
        </div>
        <div id="no-data-warning"
            style="display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: red; font-size: 24px; z-index: 2;">
            Site did not return data.
        </div>

        <button id="wind_toggle_btn" onclick="toggleWind()"
            style="display:none; position: absolute; top: 20px; right: 20px; z-index: 21; background: var(--white); border: 1px solid rgba(0,0,0,0.1); padding: 10px 20px; border-radius: 30px; cursor: pointer; font-size: 0.9rem; font-weight: 600; color: var(--text-dark); box-shadow: 0 4px 12px rgba(0,0,0,0.08);">
            Show Wind
        </button>

        <canvas id="snowChart"></canvas>
    </div>

    <!-- Install Overlays -->
    <div id="overlay3" class="modal-overlay" style="display:none; z-index: 300;" onclick="overlay_3_toggle()">
        <div class="modal-content glass-panel" style="max-width: 350px; text-align: center; margin: auto;"
            onclick="event.stopPropagation()">
            <h3 style="margin-bottom: 20px;">Install on iPhone</h3>

            <div style="display: flex; flex-direction: column; gap: 25px; margin-bottom: 25px;">
                <div class="install-step">
                    <i class="fa fa-external-link"
                        style="font-size: 2rem; color: var(--primary-color); margin-bottom: 10px; display: block;"></i>
                    <p style="margin: 0; color: var(--text-dark);">1. Tap the <strong>Share</strong> button in your
                        browser
                        toolbar.</p>
                </div>

                <div class="install-step">
                    <i class="fa fa-plus-square-o"
                        style="font-size: 2rem; color: var(--primary-color); margin-bottom: 10px; display: block;"></i>
                    <p style="margin: 0; color: var(--text-dark);">2. Scroll down and select <strong>Add to Home
                            Screen</strong>.
                    </p>
                </div>
            </div>

            <button onclick="overlay_3_toggle()"
                style="background: var(--primary-color); color: var(--white); border: none; padding: 12px 24px; border-radius: var(--radius-sm); font-weight: 600; cursor: pointer; font-size: 1rem;">Got
                it!</button>
        </div>
    </div>




    <!--Load the API from the specified URL
    * The async attribute allows the browser to render the page while the API loads
    * The key parameter will contain your own API key (which is not needed for this tutorial)
    * The callback parameter executes the initMap() function
    -->


    <script src="app.js"></script>

    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAh0B_fB92e1GfW3y-NFtDKZ68pc8DRvPU&callback=initMap"></script>

    <!-- Data Info Modal -->
    <div id="infoModal" class="modal-overlay" style="display: none;">
        <div class="modal-content glass-panel">
            <button class="modal-close" onclick="toggleInfoModal()">&times;</button>
            <h3>Understanding Your Snow Data</h3>

            <div class="modal-body">
                <h4 class="section-header">How to Use the App</h4>

                <section>
                    <h5>üó∫Ô∏è State Selector & Navigation</h5>
                    <p>Use the <strong>State Selector</strong> dropdown in the top right to switch between Western US
                        states. The
                        map remembers your location focus for each state.</p>
                </section>

                <section>
                    <h5>üìä Viewing Data Layers</h5>
                    <p>Swipe the bottom control panel to switch map modes (e.g., from "Current Depth" to "1 Day
                        Change").</p>
                </section>

                <section>
                    <h5>üèîÔ∏è Station History</h5>
                    <p>Click any colored site marker to reveal its <strong>7-day history</strong>. The chart shows daily
                        trends
                        for snow depth and temperature.</p>
                </section>

                <section>
                    <h5>üí® Wind Data</h5>
                    <p>For stations with wind sensors, tap the "Show Wind" button on the chart to see wind speed and
                        direction
                        arrows.</p>
                </section>

                <section>
                    <h5>üì± Offline Use</h5>
                    <p>This app requires an internet connection to load new map data and charts. If you are offline, you
                        will see a notice screen until connection is restored.</p>
                </section>

                <hr class="modal-divider">

                <h4 class="section-header">Metric Explanations</h4>

                <section>
                    <h5>‚ùÑÔ∏è Snow Depth (Current)</h5>
                    <p>Total snowpack depth measured at 5:00 AM today. We automatically filter out sensor errors to show
                        the most
                        valid reading.</p>
                </section>

                <section>
                    <h5>üìà 1 Day & 5 Day Change</h5>
                    <p>Change in snow depth over the last 24 hours or 5 days. Positive numbers mean new snow!</p>
                </section>

                <section>
                    <h5>üíß % Average SWE</h5>
                    <p><strong>(Current Water Content / Historical Average) * 100</strong></p>
                    <p>Compares the current snowpack's water content to the historical average for this date.
                        <strong>>100%</strong> means above average snowpack.
                    </p>
                    <p><em>Note: We use Snow Water Equivalent (SWE) for this metric as it's the standard for historical
                            comparison.</em></p>
                </section>

                <section>
                    <h5>Data Source</h5>
                    <p>Sourced directly from the <strong>NRCS Snotel Network</strong>, updated daily.</p>
                </section>
            </div>
        </div>
    </div>

    <!-- Welcome / Landing Screen -->
    <div id="welcomeScreen" class="modal-overlay" style="display: none; z-index: 200;">
        <div class="modal-content glass-panel" style="max-width: 600px; text-align: center;">
            <h3 style="font-size: 2rem; margin-bottom: 10px;">Welcome to Snotel.Info</h3>
            <p style="font-size: 1.1rem; color: var(--text-light); margin-bottom: 30px;">
                Select your region to view the latest snowpack data.
            </p>

            <div class="state-grid">
                <button onclick="selectWelcomeState('CO')">Colorado</button>
                <button onclick="selectWelcomeState('UT')">Utah</button>
                <button onclick="selectWelcomeState('CA')">California</button>
                <button onclick="selectWelcomeState('WA')">Washington</button>
                <button onclick="selectWelcomeState('OR')">Oregon</button>
                <button onclick="selectWelcomeState('ID')">Idaho</button>
                <button onclick="selectWelcomeState('MT')">Montana</button>
                <button onclick="selectWelcomeState('WY')">Wyoming</button>
                <button onclick="selectWelcomeState('NM')">New Mexico</button>
                <button onclick="selectWelcomeState('NV')">Nevada</button>
                <button onclick="selectWelcomeState('AZ')">Arizona</button>
                <button onclick="selectWelcomeState('AK')">Alaska</button>
            </div>
        </div>
    </div>

    <!-- Offline Takeover Overlay -->
    <div id="offline-overlay" class="modal-overlay"
        style="display: none; z-index: 1000; align-items: center; justify-content: center;">
        <div class="modal-content glass-panel" style="max-width: 400px; text-align: center; height: auto;">
            <i class="fa fa-wifi"
                style="font-size: 4rem; color: var(--text-light); margin-bottom: 20px; opacity: 0.5;"></i>
            <h3 style="margin-bottom: 10px; border-bottom: none;">You are Offline</h3>
            <p style="font-size: 1rem; color: var(--text-dark);">
                This app requires an internet connection to function. Please check your signal or connect to Wi-Fi.
            </p>
        </div>
    </div>

    <script src="install.js"></script>
</body>

</html>